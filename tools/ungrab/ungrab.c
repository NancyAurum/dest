/*
  UnGrab
  A command line utility which should ideally reverse the result of the
    st.exe grab 

  In other words will hopefully unpack files from the STRONG.DAT,
  recovering names, types and folder structure.

  Example use:
    ./build.bat && ./ungrab.exe ../../../dest_data/STRONG.DAT ./out


                                         -Nancy Sadkov

*/

#include <stdint.h>
#include <stddef.h>
#include <stdio.h>
#include <stdlib.h>
#include <ctype.h>
#include <string.h>

#include "nap.h"
#include "pic.h"


#define NG_UTIL_IMPLEMENTATION
#include "util.h"


#define STB_DS_IMPLEMENTATION
#include "stb_ds.h"

//ensures compiler wont add gaps between the fields.
#define PACKED __attribute__((packed)) 

//FIXME: map file hash to filename, in case we encounter STRONG.DAT with
//unknown entries.

typedef struct { //content table entry
  uint8_t state;     //0=disk, 1=loaded
  uint32_t ofs;      //offset inside STRONG.DAT
  uint32_t sz;       //size of the file
  uint8_t info[12];  //0s when in STRONG.DAT
} PACKED cte_t; //21 bytes in size

//palettes have type==0, they are at 741, 906, 917 1451, 1453, 1455, 1457

typedef struct { //stronghold graphics type1 (header size = 9)
  uint8_t type; //=1 (UI)
  uint32_t sz;
  uint16_t w;
  uint16_t h;
  //uint8 data[sz]; //RLE-packed pixels
                    //the first data byte could be either pixel or
                    //additional info
} PACKED stg_t;


typedef struct { //stronghold graphics type2 (header size = 0xE)
  uint8_t type;  //=2 (building)
  int16_t x;
  int16_t y;
  uint8_t type2; //=1
  uint32_t sz;
  uint16_t w;
  uint16_t h;
  //uint8 data[sz]; //RLE-packed pixels
                    //the first data byte could be either pixel or
                    //additional info
} PACKED stg2_t;

typedef struct { //stronghold audio (header size = 0xD)
  uint8_t type; //=3 (audio file)
  uint16_t w; //0
  uint16_t h; //0
  uint16_t sz;
  uint8_t unk[6]; //3C 00 07 B8 __ __ = preprocesed VOC
                  // unsigned 8bit PCM, little-ending, mono, 11025Hz
                  //00 3F 3F 00 00 00 = XMI
                  //07 00 10 00 00 00 = XMI
                  //3C 00 07 B8 00 00 = XMI
  //uint8 data[sz]; //RLE-packed pixels
                    //the first data byte could be either pixel or
                    //additional info
} PACKED stg3_t;


typedef struct { //stronghold graphics type4 (header size = 0x14)
  uint8_t type; //=4 (unit)
  uint8_t unk[5];
  uint8_t type2; //=2
  int16_t x;
  int16_t y;
  uint8_t type1;
  uint32_t sz;
  uint16_t w;
  uint16_t h;
  //uint8 data[sz]; //RLE-packed pixels
                    //the first data byte could be either pixel or
                    //additional info
} PACKED stg4_t;

void fail(char *fmt, ...) {
  va_list ap;
  va_start(ap, fmt);
  int l = vsnprintf(NULL, 0, fmt, ap);
  va_end(ap);
  char *s = NULL;
  arrsetlen(s, l+1);
  va_start(ap, fmt);
  vsprintf(s, fmt, ap);
  va_end(ap);
  fprintf(stderr, "%s\n", s);
  exit(-1);
}


void usage() {
#define P printf
  P("UnGrab v0.1 by Nancy Sadkov\n");
  P("Usage: ungrab path/to/STRONG.DAT output/folder/\n");
  P("\n");
  exit(0);
#undef P
}

typedef struct { //extended information
  int type;
  int16_t sx;
  int16_t sy;
  int16_t ex; //inclusive
  int16_t ey;
  int16_t ox;
  int16_t oy;
  int nid; //name id
} einfo_t;


einfo_t einfo[] = {
  //mouse03.lbm (mouse cursors)
  {0,  0,  0, 10, 15,  0,  0, 129}, //main pointer
  {0, 77, 11, 93, 27,  0,  0, 129}, //shovel
  {0, 96, 55,109, 62,  0,  0, 129}, //eye
  {0,159, 22,171, 32,  0,  0, 129}, //target

  //bigcomp.lbm (compass)
  {0,  1,  1, 51, 43,  0,  0,   1},
  {0, 53,  1,103, 43,  0,  0,   1},
  {0,105,  1,155, 43,  0,  0,   1},
  {0,157,  1,207, 43,  0,  0,   1},
  {0,  1, 45, 51, 87,  0,  0,   1},
  {0, 53, 45,103, 87,  0,  0,   1},
  {0,105, 45,155, 87,  0,  0,   1},
  {0,157, 45,207, 87,  0,  0,   1},

  //hourgls4.lbm (hourglass)
  {0,  6, 21, 27, 62,  0,  0, 508},
  {0, 29, 21, 50, 62,  0,  0, 508},
  {0, 52, 21, 73, 62,  0,  0, 508},
  {0, 75, 21, 96, 62,  0,  0, 508},
  {0, 98, 21,119, 62,  0,  0, 508},
  {0,121, 21,142, 62,  0,  0, 508},
  {0,144, 21,165, 62,  0,  0, 508},
  {0,167, 21,188, 62,  0,  0, 508},
  {0,190, 21,211, 62,  0,  0, 508},
  {0,213, 21,234, 62,  0,  0, 508},
  {0,236, 21,257, 62,  0,  0, 508},
  {0,259, 21,280, 62,  0,  0, 508},
  //smaller hourglass anim
  {0,  9, 72, 22, 75,  0,  0, 508},
  {0, 32, 72, 45, 75,  0,  0, 508},
  {0, 55, 72, 68, 75,  0,  0, 508},
  {0, 78, 72, 91, 75,  0,  0, 508},
  {0,101, 72,114, 75,  0,  0, 508},
  {0,124, 72,137, 75,  0,  0, 508},

  //frmlnd.lbm
  {0, 40,173, 50,179,  0,  0,  80},
  {0,140,108,150,114,  0,  0,  80},
  {0,240, 43,252, 49,  0,  0,  80},
  {0, 40,108, 50,114,  0,  0,  80},
  {0,140,173,150,179,  0,  0,  80},
  {0,240,108,252,114,  0,  0,  80},


  //build/geninn01.lbm (inn sprites)
  //lv1
  {0,9,130,97,194,11,-5,387},
  {0,100,130,199,194,11,-5,387},
  {0,204,130,292,194,11,-5,387},
  //Lv2
  {0,9,65,97,129,11,-5,387},
  {0,100,65,199,129,11,-5,387},
  {0,204,65,292,129,11,-5,387},
  //Lv3
  {0,9,0,97,64,11,-5,387},
  {0,108,0,191,64,11,-5,387},
  {0,204,0,292,64,11,-5,387},

  //build/geninn02.lbm (ruined inn sprites)
  {0,9,130,97,194,11,-5,485},
  {0,100,130,199,194,11,-5,485},
  {0,204,130,292,194,11,-5,485},
  {0,9,65,97,129,11,-5,485},
  {0,100,65,199,129,11,-5,485},
  {0,204,65,292,129,11,-5,485},
  {0,9,0,97,64,11,-5,485},
  {0,108,0,191,64,11,-5,485},
  {0,204,0,292,64,11,-5,485},

  //build/magres01.lbm
  {0,0,130,99,194,26,-1,392},
  {0,100,130,199,194,26,-1,392},
  {0,200,130,299,194,26,-1,392},
  {0,0,65,99,129,26,-1,392},
  {0,100,65,199,129,26,-1,392},
  {0,200,65,299,129,26,-1,392},
  {0,0,0,99,64,26,7,392},
  {0,100,0,199,64,26,7,392},
  {0,200,0,299,64,26,7,392},

  //build/magres02.lbm
  {0,0,130,99,194,26,-1,393},
  {0,100,130,199,194,26,-1,393},
  {0,200,130,299,194,26,-1,393},
  {0,0,65,99,129,26,-1,393},
  {0,100,65,199,129,26,-1,393},
  {0,200,65,299,129,26,-1,393},
  {0,0,0,99,64,26,7,393},
  {0,100,0,199,64,26,7,393},
  {0,200,0,299,64,26,7,393},

  //build/cletem01.lbm
  {0,6,151,91,180,0,-25,56},
  {0,110,151,185,180,0,-25,56},
  {0,216,151,299,180,0,-25,56},
  {0,6,72,91,115,0,-11,56},
  {0,110,72,185,115,0,-11,56},
  {0,216,72,299,115,0,-11,56},
  {0,6,6,91,59,0,-1,56},
  {0,110,6,185,59,0,-1,56},
  {0,216,6,299,59,0,-1,56},

   //psVar14 = grabLbmTR(444);
  {0,6,151,91,180,0,-25,444},
  {0,110,151,185,180,0,-25,444},
  {0,216,151,299,180,0,-25,444},
  {0,6,72,91,115,0,-11,444},
  {0,110,72,185,115,0,-11,444},
  {0,216,72,299,115,0,-11,444},
  {0,6,6,91,59,0,-1,444},
  {0,110,6,185,59,0,-1,444},
  {0,216,6,299,59,0,-1,444},

  //psVar14 = grabLbmTR(447);
  {0,2,130,89,180,0,-3,447},
  {0,108,130,191,180,0,-3,447},
  {0,212,130,298,180,0,-3,447},
  {0,2,65,89,115,0,-3,447},
  {0,108,65,191,115,0,-3,447},
  {0,212,65,298,115,0,-3,447},
  {0,2,9,89,59,0,-3,447},
  {0,108,9,191,59,0,-3,447},
  {0,212,9,298,59,0,-3,447},


  //psVar14 = grabLbmTR(448);
  {0,2,130,89,180,0,-3,448},
  {0,108,130,191,180,0,-3,448},
  {0,212,130,298,180,0,-3,448},
  {0,2,65,89,115,0,-3,448},
  {0,108,65,191,115,0,-3,448},
  {0,212,65,298,115,0,-3,448},
  {0,2,9,89,59,0,-3,448},
  {0,108,9,191,59,0,-3,448},
  {0,212,9,298,59,0,-3,448},

  //115 - grabBldLbm
  {0,0,130,99,194,26,-1,115},
  {0,100,130,199,194,26,-1,115},
  {0,200,130,299,194,26,-1,115},
  {0,0,65,99,129,26,-1,115},
  {0,100,65,199,129,26,-1,115},
  {0,200,65,299,129,26,-1,115},
  {0,0,0,99,64,26,-1,115},
  {0,100,0,199,64,26,-1,115},
  {0,200,0,299,64,26,-1,115},
  
  //116 - grabBldLbm
  {0,0,130,99,194,26,-1,116},
  {0,100,130,199,194,26,-1,116},
  {0,200,130,299,194,26,-1,116},
  {0,0,65,99,129,26,-1,116},
  {0,100,65,199,129,26,-1,116},
  {0,200,65,299,129,26,-1,116},
  {0,0,0,99,64,26,-1,116},
  {0,100,0,199,64,26,-1,116},
  {0,200,0,299,64,26,-1,116},


  //312 - grabBldLbm
  {0,0,130,99,194,26,-1,312},
  {0,100,130,199,194,26,-1,312},
  {0,200,130,299,194,26,-1,312},
  {0,0,65,99,129,26,-1,312},
  {0,100,65,199,129,26,-1,312},
  {0,200,65,299,129,26,-1,312},
  {0,0,0,99,64,26,-1,312},
  {0,100,0,199,64,26,-1,312},
  {0,200,0,299,64,26,-1,312},

  
  //446 - grabBldLbm
  {0,0,130,99,194,26,-1,446},
  {0,100,130,199,194,26,-1,446},
  {0,200,130,299,194,26,-1,446},
  {0,0,65,99,129,26,-1,446},
  {0,100,65,199,129,26,-1,446},
  {0,200,65,299,129,26,-1,446},
  {0,0,0,99,64,26,-1,446},
  {0,100,0,199,64,26,-1,446},
  {0,200,0,299,64,26,-1,446},

  //312 - grabBldLbm
  {0,0,130,99,194,26,-1,312},
  {0,100,130,199,194,26,-1,312},
  {0,200,130,299,194,26,-1,312},
  {0,0,65,99,129,26,-1,312},
  {0,100,65,199,129,26,-1,312},
  {0,200,65,299,129,26,-1,312},
  {0,0,0,99,64,26,-1,312},
  {0,100,0,199,64,26,-1,312},
  {0,200,0,299,64,26,-1,312},

  //313- grabBldLbm
  {0,0,130,99,194,26,-1,313},
  {0,100,130,199,194,26,-1,313},
  {0,200,130,299,194,26,-1,313},
  {0,0,65,99,129,26,-1,313},
  {0,100,65,199,129,26,-1,313},
  {0,200,65,299,129,26,-1,313},
  {0,0,0,99,64,26,-1,313},
  {0,100,0,199,64,26,-1,313},
  {0,200,0,299,64,26,-1,313},


  //psVar14 = grabLbmTR(459);
  {0,9,68,92,182,-4,56,459},
  {0,108,68,191,182,-3,566,459},
  {0,208,68,291,182,-1,566,459},


  //tg = grabLbmTR(460);
  {0,  9, 68, 92,182, -4, 56, 460},
  {0,108, 68,191,182, -3, 56, 460},
  {0,208, 68,291,182, -1, 56, 460},


  //grabLbmTR(172);
  {0, 20, 33, 99,116,  8, 28, 172},
  {0,120, 33,199,116,  8, 28, 172},
  {0,220, 33,299,116,  8, 28, 172},

  //grabLbmTR(175);
  {0, 20, 33, 99,116,  8, 28, 175},
  {0,120, 33,199,116,  8, 28, 175},
  {0,220, 33,299,116,  8, 28, 175},


  //psVar14 = grabLbmTR(174);
  {0,100,130,199,194,26,-4,174},
  {0,100,65,199,129,26,-4,174},
  {0,100,0,199,64,26,-4,174},
  
  //tg = grabLbmTR(176);
  {0,100,130,199,194,26,-4,176},
  {0,100,65,199,129,26,-4,176},
  {0,100,0,199,64,26,-4,176},



  //449 - grabBldLbm
  {0,0,130,99,194,26,-1,449},
  {0,100,130,199,194,26,-1,449},
  {0,200,130,299,194,26,-1,449},
  {0,0,65,99,129,26,-1,449},
  {0,100,65,199,129,26,-1,449},
  {0,200,65,299,129,26,-1,449},
  {0,0,0,99,64,26,-1,449},
  {0,100,0,199,64,26,-1,449},
  {0,200,0,299,64,26,-1,449},

  //450- grabBldLbm
  {0,0,130,99,194,26,-1,313},
  {0,100,130,199,194,26,-1,313},
  {0,200,130,299,194,26,-1,313},
  {0,0,65,99,129,26,-1,313},
  {0,100,65,199,129,26,-1,313},
  {0,200,65,299,129,26,-1,313},
  {0,0,0,99,64,26,-1,313},
  {0,100,0,199,64,26,-1,313},
  {0,200,0,299,64,26,-1,313},

  //390 - grabBldLbm
  {0,0,130,99,194,26,-1,390},
  {0,100,130,199,194,26,-1,390},
  {0,200,130,299,194,26,-1,390},
  {0,0,65,99,129,26,-1,390},
  {0,100,65,199,129,26,-1,390},
  {0,200,65,299,129,26,-1,390},
  {0,0,0,99,64,26,-1,390},
  {0,100,0,199,64,26,-1,390},
  {0,200,0,299,64,26,-1,390},

  //391- grabBldLbm
  {0,0,130,99,194,26,-1,391},
  {0,100,130,199,194,26,-1,391},
  {0,200,130,299,194,26,-1,391},
  {0,0,65,99,129,26,-1,391},
  {0,100,65,199,129,26,-1,391},
  {0,200,65,299,129,26,-1,391},
  {0,0,0,99,64,26,-1,391},
  {0,100,0,199,64,26,-1,391},
  {0,200,0,299,64,26,-1,391},

  //389 - grabBldLbm
  {0,0,130,99,194,26,-1,389},
  {0,100,130,199,194,26,-1,389},
  {0,200,130,299,194,26,-1,389},
  {0,0,65,99,129,26,-1,389},
  {0,100,65,199,129,26,-1,389},
  {0,200,65,299,129,26,-1,389},
  {0,0,0,99,64,26,-1,389},
  {0,100,0,199,64,26,-1,389},
  {0,200,0,299,64,26,-1,389},

  //442- grabBldLbm
  {0,0,130,99,194,26,-1,442},
  {0,100,130,199,194,26,-1,442},
  {0,200,130,299,194,26,-1,442},
  {0,0,65,99,129,26,-1,442},
  {0,100,65,199,129,26,-1,442},
  {0,200,65,299,129,26,-1,442},
  {0,0,0,99,64,26,-1,442},
  {0,100,0,199,64,26,-1,442},
  {0,200,0,299,64,26,-1,442},


  //grabLbmTR(394);
  {0,6,151,91,180,-10,-26,394},
  {0,110,151,185,180,-10,-26,394},
  {0,216,151,299,180,-10,-26,394},
  {0,6,72,91,115,-10,-12,394},
  {0,110,72,185,115,-10,-12,394},
  {0,216,72,299,115,-10,-12,394},
  {0,6,6,91,59,-10,-4,394},
  {0,110,6,185,59,-10,-4,394},
  {0,216,6,299,59,-10,-4,394},

  //psVar14 = grabLbmTR(443);
  {0,6,151,91,180,-10,-26,443},
  {0,110,151,185,180,-10,-26,443},
  {0,216,151,299,180,-10,-26,443},
  {0,6,72,91,115,-10,-12,443},
  {0,110,72,185,115,-10,-12,443},
  {0,216,72,299,115,-10,-12,443},
  {0,6,6,91,59,-10,-4,443},
  {0,110,6,185,59,-10,-4,443},
  {0,216,6,299,59,-10,-4,443},


  //tg = grabLbmTR(173);
  {0,0,130,99,194,26,0,173},
  {0,100,130,199,194,26,0,173},
  {0,200,130,299,194,26,0,173},
  {0,0,65,99,129,26,0,173},
  {0,100,65,199,129,26,0,173},
  {0,200,65,299,129,26,0,173},



  //314 - grabBldLbm
  {0,0,130,99,194,26,-1,314},
  {0,100,130,199,194,26,-1,314},
  {0,200,130,299,194,26,-1,314},
  {0,0,65,99,129,26,-1,314},
  {0,100,65,199,129,26,-1,314},
  {0,200,65,299,129,26,-1,314},
  {0,0,0,99,64,26,-1,314},
  {0,100,0,199,64,26,-1,314},
  {0,200,0,299,64,26,-1,314},

  //315- grabBldLbm
  {0,0,130,99,194,26,-1,315},
  {0,100,130,199,194,26,-1,315},
  {0,200,130,299,194,26,-1,315},
  {0,0,65,99,129,26,-1,315},
  {0,100,65,199,129,26,-1,315},
  {0,200,65,299,129,26,-1,315},
  {0,0,0,99,64,26,-1,315},
  {0,100,0,199,64,26,-1,315},
  {0,200,0,299,64,26,-1,315},


  //316 - grabBldLbm
  {0,0,130,99,194,26,-1,316},
  {0,100,130,199,194,26,-1,316},
  {0,200,130,299,194,26,-1,316},
  {0,0,65,99,129,26,-1,316},
  {0,100,65,199,129,26,-1,316},
  {0,200,65,299,129,26,-1,316},
  {0,0,0,99,64,26,-1,316},
  {0,100,0,199,64,26,-1,316},
  {0,200,0,299,64,26,-1,316},

  //317- grabBldLbm
  {0,0,130,99,194,26,-1,317},
  {0,100,130,199,194,26,-1,317},
  {0,200,130,299,194,26,-1,317},
  {0,0,65,99,129,26,-1,317},
  {0,100,65,199,129,26,-1,317},
  {0,200,65,299,129,26,-1,317},
  {0,0,0,99,64,26,-1,317},
  {0,100,0,199,64,26,-1,317},
  {0,200,0,299,64,26,-1,317},


  //psVar14 = grabLbmTR(320);
  {0,58,141,134,199,-4,0,320},
  {0,58,84,134,142,-4,0,320},
  {0,58,25,134,83,-4,0,320},

  //tg = grabLbmTR(321);
  {0,58,141,134,199,-4,0,321},
  {0,58,84,134,142,-4,0,321},
  {0,58,25,134,83,-4,0,321},

  //tg = grabLbmTR(500);
  {0,  3,  0, 50, 54,  0,  1, 500},
  {0,  3, 62, 50,116,  0,  1, 500},
  {0,  3, 62, 50,116,  0,  1, 500},
  {0, 51,  0, 98, 54,  0,  1, 500},
  {0, 51, 62, 98,116,  0,  1, 500},
  {0, 51, 62, 98,116,  0,  1, 500},
  {0, 99,  0,146, 54,  0,  1, 500},
  {0, 99, 62,146,116,  0,  1, 500},
  {0, 99, 62,146,116,  0,  1, 500},
  {0,147,  0,194, 54,  0,  1, 500},
  {0,147, 62,194,116,  0,  1, 500},
  {0,147, 62,194,116,  0,  1, 500},

  //tg = grabLbmTR(501);
  {0,  3,  0, 50, 54,  0,  1, 501},
  {0,  3, 62, 50,116,  0,  1, 501},
  {0,  3, 62, 50,116,  0,  1, 501},
  {0, 51,  0, 98, 54,  0,  1, 501},
  {0, 51, 62, 98,116,  0,  1, 501},
  {0, 51, 62, 98,116,  0,  1, 501},
  {0, 99,  0,146, 54,  0,  1, 501},
  {0, 99, 62,146,116,  0,  1, 501},
  {0, 99, 62,146,116,  0,  1, 501},
  {0,147,  0,194, 54,  0,  1, 501},
  {0,147, 62,194,116,  0,  1, 501},
  {0,147, 62,194,116,  0,  1, 501},


  //tg = grabLbmTR(502);
  {0,  3,  0, 50, 54,  0,  1, 502},
  {0,  3, 62, 50,116,  0,  1, 502},
  {0,  3, 62, 50,116,  0,  1, 502},
  {0, 51,  0, 98, 54,  0,  1, 502},
  {0, 51, 62, 98,116,  0,  1, 502},
  {0, 51, 62, 98,116,  0,  1, 502},
  {0, 99,  0,146, 54,  0,  1, 502},
  {0, 99, 62,146,116,  0,  1, 502},
  {0, 99, 62,146,116,  0,  1, 502},
  {0,147,  0,194, 54,  0,  1, 502},
  {0,147, 62,194,116,  0,  1, 502},
  {0,147, 62,194,116,  0,  1, 502},

  //tg = grabLbmTR(503);
  {0,  3,  0, 50, 54,  0,  1, 503},
  {0,  3, 62, 50,116,  0,  1, 503},
  {0,  3, 62, 50,116,  0,  1, 503},
  {0, 51,  0, 98, 54,  0,  1, 503},
  {0, 51, 62, 98,116,  0,  1, 503},
  {0, 51, 62, 98,116,  0,  1, 503},
  {0, 99,  0,146, 54,  0,  1, 503},
  {0, 99, 62,146,116,  0,  1, 503},
  {0, 99, 62,146,116,  0,  1, 503},
  {0,147,  0,194, 54,  0,  1, 503},
  {0,147, 62,194,116,  0,  1, 503},
  {0,147, 62,194,116,  0,  1, 503},

  //504
  {0,  3,  0, 50, 54,  0,  1, 504},
  {0,  3, 62, 50,116,  0,  1, 504},
  {0,  3, 62, 50,116,  0,  1, 504},
  {0, 51,  0, 98, 54,  0,  1, 504},
  {0, 51, 62, 98,116,  0,  1, 504},
  {0, 51, 62, 98,116,  0,  1, 504},
  {0, 99,  0,146, 54,  0,  1, 504},
  {0, 99, 62,146,116,  0,  1, 504},
  {0, 99, 62,146,116,  0,  1, 504},
  {0,147,  0,194, 54,  0,  1, 504},
  {0,147, 62,194,116,  0,  1, 504},
  {0,147, 62,194,116,  0,  1, 504},

  //505
  {0,  3,  0, 50, 54,  0,  1, 505},
  {0,  3, 62, 50,116,  0,  1, 505},
  {0,  3, 62, 50,116,  0,  1, 505},
  {0, 51,  0, 98, 54,  0,  1, 505},
  {0, 51, 62, 98,116,  0,  1, 505},
  {0, 51, 62, 98,116,  0,  1, 505},
  {0, 99,  0,146, 54,  0,  1, 505},
  {0, 99, 62,146,116,  0,  1, 505},
  {0, 99, 62,146,116,  0,  1, 505},
  {0,147,  0,194, 54,  0,  1, 505},
  {0,147, 62,194,116,  0,  1, 505},
  {0,147, 62,194,116,  0,  1, 505},


  //11
  {0,  0,  0, 99, 64, 30, -4, 11},
  {0,100,  0,199, 64, 30, -4, 11},
  {0,200,  0,299, 64, 30, -4, 11},
  {0,  0, 65, 99,129, 30, -4, 11},
  {0,100, 65,199,129, 30, -4, 11},
  {0,200, 65,299,129, 30, -4, 11},
  {0,  0,130, 99,194, 30, -4, 11},
  {0,100,130,199,194, 30, -4, 11},
  {0,200,130,299,194, 30, -4, 11},


  //grabLbmTR(52);
  {0,167, 12,206, 32, -4,-37, 52},
  {0,167, 45,206, 65, -4,-37, 52},
  {0,167, 78,206, 98, -4,-37, 52},
  {0, 13, 20, 16, 32,-22,-44, 52},
  {0, 95, 20, 98, 32,-22,-44, 52},
  {0, 13, 53, 16, 65,-22,-44, 52},
  {0, 95, 53, 98, 65,-22,-44, 52},
  {0, 13, 86, 16, 98,-22,-44, 52},
  {0, 95, 86, 98, 98,-22,-44, 52},
  {0, 13,119, 16,131,-22,-44, 52},
  {0, 95,119, 98,131,-22,-44, 52},
  {0, 13,152, 16,164,-22,-44, 52},
  {0, 95,152, 98,164,-22,-44, 52},
  {0, 13,185, 16,197,-22,-44, 52},
  {0, 95,185, 98,197,-22,-44, 52},
  {0, 43, 20, 46, 32,-22,-44, 52},
  {0,125, 20,128, 32,-22,-44, 52},



  //psVar14 = grabLbmTR(308);
  {0,2,86,85,180,-2,38,308},
  {0,108,86,191,180,-2,38,308},
  {0,208,86,298,180,0,38,308},

  //tg = grabLbmTR(309);
  {0,2,86,85,180,-2,38,309},
  {0,108,86,191,180,-2,38,309},
  {0,208,86,298,180,0,38,309},



  //psVar14 = grabLbmTR(467);
  {0,4,74,91,180,-3,50,467},
  {0,110,74,195,180,-3,50,467},
  {0,204,74,299,180,3,50,467},


  //tg = grabLbmTR(468);
  {0,4,74,91,180,-3,50,468},
  {0,110,74,195,180,-3,50,468},
  {0,204,74,299,180,3,50,468},

  
  //psVar14 = grabLbmTR(513);
  {0,2,70,86,180,0,52,513},
  {0,108,70,191,180,0,52,513},
  {0,215,70,298,180,0,52,513},


  //psVar14 = grabLbmTR(514);
  {0,2,70,86,180,0,52,514},
  {0,108,70,191,180,0,52,514},
  {0,215,70,298,180,0,52,514},

  //psVar14 = grabLbmTR(517);
  {0,2,70,86,180,0,52,517},
  {0,108,70,191,180,0,52,517},
  {0,215,70,298,180,0,52,517},


  //psVar14 = grabLbmTR(518);
  {0,2,70,86,180,0,52,518},
  {0,108,70,191,180,0,52,518},
  {0,215,70,298,180,0,52,518},


  //psVar14 = grabLbmTR(525);
  {0,108,70,191,180,0,52,525},


  //tg = grabLbmTR(526);
  {0,108,70,191,180,0,52,526},

  //psVar14 = grabLbmTR(515);
  {0,2,70,86,180,0,52,515},
  {0,108,70,191,180,0,52,515},
  {0,215,70,298,180,0,52,515},

  //psVar14 = grabLbmTR(516);
  {0,2,70,86,180,0,52,516},
  {0,108,70,191,180,0,52,516},
  {0,215,70,298,180,0,52,516},

  //psVar14 = grabLbmTR(519);
  {0,108,70,191,180,0,52,519},


  //tg = grabLbmTR(520);
  {0,108,70,191,180,0,52,520},


  //psVar14 = grabLbmTR(521);
  {0,108,70,191,180,0,52,521},


  //tg = grabLbmTR(522);
  {0,108,70,191,180,0,52,522},


  //psVar14 = grabLbmTR(523);
  {0, 80, 39,104, 58,-68, 22, 523},
  {0,114, 39,138, 58,-68, 22, 523},
  {0,148, 39,172, 58,-68, 22, 523},
  {0,182, 39,206, 58,-68, 22, 523},
  {0,216, 39,240, 58,-68, 22, 523},
  {0, 82, 87,222,181, 22, 32, 523},
  {0, 82, 87,222,181, 22, 32, 523},


  //156
  {0,  0,101,319,199, 60, 26, 156},
  {0,  0,  0,319,100, 60, 28, 156},

  //441
  {0,  0,101,319,199, 60, 26, 441},
  {0,  0,  0,319,100, 60, 28, 441},

  //157
  {0,  0, 70,319,193, 60, 51, 157},

  //440
  {0,  0, 70,319,193, 60, 51, 440},


  //psVar14 = grabLbmTR(318);
  {0,8,50,110,154,-4,45,318},
  {0,111,50,212,154,-4,45,318},
  {0,213,50,313,154,-4,45,318},


  //tg = grabLbmTR(319);
  {0,8,50,110,154,-4,45,319},
  {0,111,50,212,154,-4,45,319},
  {0,213,50,313,154,-4,45,319},

  //tg = grabLbm(17,0,0);
  {0,135,  0,269, 64, 30,-10, 17},
  {0,  0, 65,134,129, 30,-10, 17},
  {0,135, 65,269,129, 30,-10, 17},
  {0,  0,130,134,194, 30,-10, 17},
  {0,135,130,269,194, 30,-10, 17},

  //grabLbmTR(31);  
  {0,0,18,200,33,0,0,31},
  {0,131,74,179,130,0,0,31},
  {0,31,49,79,55,0,0,31},
  {0,0,49,200,65,0,0,31},
  {0,31,74,79,130,0,0,31},
  {0,131,49,179,55,0,0,31},
  {0,0,1,200,17,0,0,31},
  {0,231,49,279,55,0,0,31},

  //psVar14 = grabLbmTR(51);
  {0,131,49,219,65,0,0,51},
  {0,131,74,179,130,0,0,51},
  {0,131,59,179,65,0,0,51},


  //psVar14 = grabLbmTR(288);
  {0,0,51,200,65,0,0,288},
  {0,31,74,79,130,0,0,288},
  {0,0,51,48,57,0,0,288},
  {0,0,14,200,28,0,0,288},
  {0,131,74,179,130,0,0,288},
  {0,0,14,48,20,0,0,288},
  {0,0,168,200,195,0,0,288},
  {0,231,74,279,130,0,0,288},
  {0,0,168,48,187,0,13,288},

  //psVar14 = grabLbmTR(462);
  {0,13,28,96,119,0,32,462},
  {0,119,28,202,119,0,32,462},
  {0,226,28,309,119,0,32,462},


  //psVar14 = grabLbmTR(463);
  {0,13,28,96,119,0,32,463},
  {0,119,28,202,119,0,32,463},
  {0,226,28,309,119,0,32,463},







  //grabLbmTR(489,_},
  {0,27,126,110,176,0,-6,489},
  {0,118,126,201,176,0,-6,489},
  {0,209,126,292,176,0,-6,489},
  {0,27,69,110,119,0,-6,489},
  {0,118,69,201,119,0,-6,489},
  {0,209,69,292,119,0,-6,489},
  {0,27,11,110,61,0,-6,489},
  {0,118,11,201,61,0,-6,489},
  {0,209,11,292,61,0,-6,489},

  //grabLbmTR(490)
  {0,27,126,110,176,0,-6,490},
  {0,118,126,201,176,0,-6,490},
  {0,209,126,292,176,0,-6,490},
  {0,27,69,110,119,0,-6,490},
  {0,118,69,201,119,0,-6,490},
  {0,209,69,292,119,0,-6,490},
  {0,27,11,110,61,0,-6,490},
  {0,118,11,201,61,0,-6,490},
  {0,209,11,292,61,0,-6,490},

  //grabLbmTR(491)
  {0,2,130,95,180,0,-6,491},
  {0,108,130,191,180,0,-6,491},
  {0,204,130,298,180,0,-6,491},
  {0,2,70,95,120,0,-6,491},
  {0,108,70,191,120,0,-6,491},
  {0,204,70,298,120,0,-6,491},
  {0,2,9,95,59,0,-6,491},
  {0,108,9,191,59,0,-6,491},
  {0,204,9,298,59,0,-6,491},

  //grabLbmTR(492)
  {0,2,130,95,180,0,-6,492},
  {0,108,130,191,180,0,-6,492},
  {0,204,130,298,180,0,-6,492},
  {0,2,70,95,120,0,-6,492},
  {0,108,70,191,120,0,-6,492},
  {0,204,70,298,120,0,-6,492},
  {0,2,9,95,59,0,-6,492},
  {0,108,9,191,59,0,-6,492},
  {0,204,9,298,59,0,-6,492},

  //grabLbmTR(493)
  {0,27,126,110,176,-10,-6,493},
  {0,118,126,201,176,-10,-6,493},
  {0,209,126,292,176,-10,-6,493},
  {0,27,69,110,119,-10,-6,493},
  {0,118,69,201,119,-10,-6,493},
  {0,209,69,292,119,-10,-6,493},
  {0,27,1,110,61,-10,4,493},
  {0,118,1,201,61,-10,4,493},
  {0,209,1,292,61,-10,4,493},

  //grabLbmTR(494)
  {0,27,126,110,176,-10,-6,494},
  {0,118,126,201,176,-10,-6,494},
  {0,209,126,292,176,-10,-6,494},
  {0,27,69,110,119,-10,-6,494},
  {0,118,69,201,119,-10,-6,494},
  {0,209,69,292,119,-10,-6,494},
  {0,27,1,110,61,-10,4,494},
  {0,118,1,201,61,-10,4,494},
  {0,209,1,292,61,-10,4,494},



  //grabBldLbm(473,474,0xb4,_},
  {0,0,130,99,194,26,-1,473},
  {0,100,130,199,194,26,-1,473},
  {0,200,130,299,194,26,-1,473},
  {0,0,65,99,129,26,-1,473},
  {0,100,65,199,129,26,-1,473},
  {0,200,65,299,129,26,-1,473},
  {0,0,0,99,64,26,-1,473},
  {0,100,0,199,64,26,-1,473},
  {0,200,0,299,64,26,-1,473},

  //grabBldLbm(473,474,0xb4,_},
  {0,0,130,99,194,26,-1,474},
  {0,100,130,199,194,26,-1,474},
  {0,200,130,299,194,26,-1,474},
  {0,0,65,99,129,26,-1,474},
  {0,100,65,199,129,26,-1,474},
  {0,200,65,299,129,26,-1,474},
  {0,0,0,99,64,26,-1,474},
  {0,100,0,199,64,26,-1,474},
  {0,200,0,299,64,26,-1,474},


  //grabLbmTR(475)
  {0,2,75,85,115,0,-15,475},
  {0,108,75,191,115,0,-15,475},
  {0,215,75,298,115,0,-15,475},

  //grabLbmTR(476)
  {0,2,75,85,115,0,-15,476},
  {0,108,75,191,115,0,-15,476},
  {0,215,75,298,115,0,-15,476},

  //grabLbmTR(498)
  {0,108,50,191,115,-4,9,498},

  //grabLbmTR(499)
  {0,108,50,191,115,-4,9,498},


  //grabLbmTR(471)
  {0,110,151,185,180,-8,-26,471},
  {0,110,72,185,115,-8,-12,471},
  {0,110,6,185,59,-8,-2,471},

  //grabLbmTR(472)
  {0,110,151,185,180,-8,-26,472},
  {0,110,72,185,115,-8,-12,472},
  {0,110,6,185,59,-8,-2,472},

  //grabLbmTR(477)
  {0,107,124,191,183,0,3,477},

  //grabLbmTR(478)
  {0,107,124,191,183,0,3,478},


  //grabLbmTR(487)
  {0,107,126,191,166,0,-15,487},

  //grabLbmTR(488)
  {0,107,126,191,166,0,-15,488},

  //grabLbmTR(536)
  {0,13,145,99,187,0,-16,536},
  {0,108,145,195,187,0,-16,536},
  {0,204,145,292,187,0,-16,536},
  {0,13,78,99,134,0,-2,536},
  {0,108,78,195,134,0,-2,536},
  {0,204,78,292,134,0,-2,536},
  {0,13,1,99,62,0,3,536},
  {0,108,1,195,62,0,3,536},
  {0,204,1,292,62,0,3,536},

  //grabLbmTR(537)
  {0,13,145,99,187,0,-16,537},
  {0,108,145,195,187,0,-16,537},
  {0,204,145,292,187,0,-16,537},
  {0,13,78,99,134,0,-2,537},
  {0,108,78,195,134,0,-2,537},
  {0,204,78,292,134,0,-2,537},
  {0,13,1,99,62,0,3,537},
  {0,108,1,195,62,0,3,537},
  {0,204,1,292,62,0,3,537},

  //grabLbmTR(495)
  {0,71,59,238,129,-10,1,495},

  //grabLbmTR(496)
  {0,71,59,238,129,-10,1,496},

  //grabLbmTR(469)
  {0,9,118,92,183,0,9,469},
  {0,108,118,191,183,0,9,469},
  {0,207,118,291,183,0,9,469},

  //grabLbmTR(470)
  {0,9,118,92,183,0,9,470},
  {0,108,118,191,183,0,9,470},
  {0,207,118,291,183,0,9,470},

  //grabLbmTR(479)
  {0,2,140,85,180,0,-15,479},
  {0,2,75,85,115,0,-15,479},
  {0,2,19,85,59,0,-15,479},

  //grabLbmTR(480)
  {0,2,140,85,180,0,-15,480},
  {0,2,75,85,115,0,-15,480},
  {0,2,19,85,59,0,-15,480},


  //grabLbmTR(486)
  {0,2,133,93,179,0,-9,486},
  {0,107,133,192,179,0,-9,486},
  {0,215,133,304,179,0,-9,486},
  {0,2,68,93,114,0,-9,486},
  {0,107,68,192,114,0,-9,486},
  {0,215,68,304,114,0,-9,486},
  {0,2,12,93,58,0,-9,486},
  {0,107,12,192,58,0,-9,486},
  {0,215,12,304,58,0,-9,486},

  //grabLbmTR(497)
  {0,2,133,93,179,0,-9,497},
  {0,107,133,192,179,0,-9,497},
  {0,215,133,304,179,0,-9,497},
  {0,2,68,93,114,0,-9,497},
  {0,107,68,192,114,0,-9,497},
  {0,215,68,304,114,0,-9,497},
  {0,2,12,93,58,0,-9,497},
  {0,107,12,192,58,0,-9,497},
  {0,215,12,304,58,0,-9,497},

  //grabLbmTR(481)
  {0,2,140,85,180,-3,-14,481},
  {0,108,140,191,180,-3,-14,481},
  {0,215,140,298,180,-3,-14,481},
  {0,2,75,85,115,-3,-14,481},
  {0,108,75,191,115,-3,-14,481},
  {0,215,75,298,115,-3,-14,481},
  {0,2,19,85,59,-3,-14,481},
  {0,108,19,191,59,-3,-14,481},
  {0,215,19,298,59,-3,-14,481},

  //grabLbmTR(482)
  {0,2,140,85,180,-3,-14,482},
  {0,108,140,191,180,-3,-14,482},
  {0,215,140,298,180,-3,-14,482},
  {0,2,75,85,115,-3,-14,482},
  {0,108,75,191,115,-3,-14,482},
  {0,215,75,298,115,-3,-14,482},
  {0,2,19,85,59,-3,-14,482},
  {0,108,19,191,59,-3,-14,482},
  {0,215,19,298,59,-3,-14,482},

  //grabLbmTR(483)
  {0,2,133,85,192,-10,5,483},
  {0,108,133,191,192,-10,5,483},
  {0,215,133,298,192,-10,5,483},
  {0,2,73,85,132,-10,5,483},
  {0,108,73,191,132,-10,5,483},
  {0,215,73,298,132,-10,5,483},
  {0,2,13,85,72,-10,5,483},
  {0,108,13,191,72,-10,5,483},
  {0,215,13,298,72,-10,5,483},

  //grabLbmTR(484)
  {0,2,133,85,192,-10,5,484},
  {0,108,133,191,192,-10,5,484},
  {0,215,133,298,192,-10,5,484},
  {0,2,73,85,132,-10,5,484},
  {0,108,73,191,132,-10,5,484},
  {0,215,73,298,132,-10,5,484},
  {0,2,13,85,72,-10,5,484},
  {0,108,13,191,72,-10,5,484},
  {0,215,13,298,72,-10,5,484},

  //grabBldLbm(506,507,0xd7,_},
  {0,0,130,99,194,26,-1,506},
  {0,100,130,199,194,26,-1,506},
  {0,200,130,299,194,26,-1,506},
  {0,0,65,99,129,26,-1,506},
  {0,100,65,199,129,26,-1,506},
  {0,200,65,299,129,26,-1,506},
  {0,0,0,99,64,26,-1,506},
  {0,100,0,199,64,26,-1,506},
  {0,200,0,299,64,26,-1,506},

  //grabBldLbm(506,507,0xd7,_},
  {0,0,130,99,194,26,-1,507},
  {0,100,130,199,194,26,-1,507},
  {0,200,130,299,194,26,-1,507},
  {0,0,65,99,129,26,-1,507},
  {0,100,65,199,129,26,-1,507},
  {0,200,65,299,129,26,-1,507},
  {0,0,0,99,64,26,-1,507},
  {0,100,0,199,64,26,-1,507},
  {0,200,0,299,64,26,-1,507},

  //grabBldLbm2(218,509,510);
  {0,0,130,99,194,26,-1,509},
  {0,100,130,199,194,26,-1,509},
  {0,200,130,299,194,26,-1,509},
  {0,0,65,99,129,26,-1,509},
  {0,100,65,199,129,26,-1,509},
  {0,200,65,299,129,26,-1,509},
  {0,0,0,99,64,26,-1,509},
  {0,100,0,199,64,26,-1,509},
  {0,200,0,299,64,26,-1,509},

   //grabBldLbm2(218,509,510);
  {0,0,130,99,194,26,-1,510},
  {0,100,130,199,194,26,-1,510},
  {0,200,130,299,194,26,-1,510},
  {0,0,65,99,129,26,-1,510},
  {0,100,65,199,129,26,-1,510},
  {0,200,65,299,129,26,-1,510},
  {0,0,0,99,64,26,-1,510},
  {0,100,0,199,64,26,-1,510},
  {0,200,0,299,64,26,-1,510},


  //grabBldLbm2(227,511,512);
  {0,0,130,99,194,26,-1,511},
  {0,100,130,199,194,26,-1,511},
  {0,200,130,299,194,26,-1,511},
  {0,0,65,99,129,26,-1,511},
  {0,100,65,199,129,26,-1,511},
  {0,200,65,299,129,26,-1,511},
  {0,0,0,99,64,26,-1,511},
  {0,100,0,199,64,26,-1,511},
  {0,200,0,299,64,26,-1,511},

  //grabBldLbm2(227,511,512);
  {0,0,130,99,194,26,-1,512},
  {0,100,130,199,194,26,-1,512},
  {0,200,130,299,194,26,-1,512},
  {0,0,65,99,129,26,-1,512},
  {0,100,65,199,129,26,-1,512},
  {0,200,65,299,129,26,-1,512},
  {0,0,0,99,64,26,-1,512},
  {0,100,0,199,64,26,-1,512},
  {0,200,0,299,64,26,-1,512},

  //grabLbmTR(527);
  {0, 20, 33, 99,116, 10, 28, 527},
  {0,120, 33,199,116, 10, 28, 527},
  {0,220, 33,299,116, 10, 28, 527},

  //grabLbmTR(528);
  {0, 20, 33, 99,116, 10, 28, 528},
  {0,120, 33,199,116, 10, 28, 528},
  {0,220, 33,299,116, 10, 28, 528},


  //grabLbmTR(529);
  {0,0,130,99,194,26,-1,529},
  {0,100,130,199,194,26,-1,529},
  {0,200,130,299,194,26,-1,529},
  {0,0,65,99,129,26,-1,529},
  {0,100,65,199,129,26,-1,529},
  {0,200,65,299,129,26,-1,529},
  {0,0,0,99,64,26,-1,529},
  {0,100,0,199,64,26,-1,529},
  {0,200,0,299,64,26,-1,529},


  //grabLbmTR(10);
  {0,12,7,222,150,-12,-7,10},
  {0,239,7,308,54,0,0,10},


  //special palette colors, sampled from triangls.lbm
  //these shouldn't be extracted
  {9,0,0,0,0,0,0,544},
  
  //grabLbmTR(14);
  {0,234,64,314,120,0,0,14},
  {0,208,158,228,176,0,0,14},
  {0,179,180,198,196,0,0,14},
  {0,207,180,226,196,0,0,14},
  {0,38,181,57,196,0,0,14},
  {0,9,181,24,196,0,0,14},

  //grabLbmTR(127);
  {0,245,116,267,128,0,0,127},
  {0,292,114,314,133,0,0,127},
  {0,221,157,228,198,0,0,127},


  //nwpanel1.pal
  {9,0,0,0,0,0,0,545},


  //grabLbm(15,0,0);
  {0,230,57,314,113,0,0,15},
  {0,0,0,319,199,0,0,15},
  {0,29,156,207,199,0,0,15},
  {0,9,181,28,196,0,0,15},
  {0,223,8,237,50,0,0,15},
  {0,6,156,28,171,0,0,15},
  {0,208,157,229,198,0,0,15},


  //grabLbm(12,0,0);
  {0,  0, 46, 13, 55,  0,  0, 12},
  {0,  0, 16, 13, 24,  6,  4, 12},
  {0, 14, 46, 27, 55,  0,  0, 12},
  {0, 14, 16, 27, 24,  6,  4, 12},
  {0, 28, 46, 41, 55,  0,  0, 12},
  {0, 28, 16, 41, 24,  6,  4, 12},
  {0, 42, 46, 55, 55,  0,  0, 12},
  {0, 42, 16, 55, 24,  6,  4, 12},


  {0,  8, 10, 63, 36,  0,  0, 93},
  {0,  8, 42, 63, 68,  0,  0, 93},
  {0,  8, 74, 63,100,  0,  0, 93},
  {0,  8,106, 63,132,  0,  0, 93},
  {0,  8,138, 63,164,  0,  0, 93},
  {0,  8,170, 63,196,  0,  0, 93},
  {0, 85, 10,140, 36,  0,  0, 93},
  {0, 85, 42,140, 68,  0,  0, 93},
  {0, 85, 74,140,100,  0,  0, 93},
  {0, 85,106,140,132,  0,  0, 93},
  {0, 85,138,140,164,  0,  0, 93},
  {0, 85,170,140,196,  0,  0, 93},
  {0,159, 10,214, 36,  0,  0, 93},
  {0,159, 42,214, 68,  0,  0, 93},
  {0,159, 74,214,100,  0,  0, 93},
  {0,159,106,214,132,  0,  0, 93},
  {0,159,138,214,164,  0,  0, 93},
  {0,159,170,214,196,  0,  0, 93},
  {0,229, 10,284, 36,  0,  0, 93},
  {0,229, 42,284, 68,  0,  0, 93},
  {0,229, 74,284,100,  0,  0, 93},
  {0,229,106,284,132,  0,  0, 93},
  {0,229,138,284,164,  0,  0, 93},


  {0,  0, 17,104, 73,  0,-60, 94},
  {0,  0, 78,104,134,  0,-60, 94},
  {0,  0,139,104,195,  0,-60, 94},
  {0,109, 17,213, 73,  0,-60, 94},
  {0,109, 78,213,134,  0,-60, 94},
  {0,109,139,213,195,  0,-60, 94},
  {0,215, 17,319, 73,  0,-60, 94},
  {0,215, 78,319,134,  0,-60, 94},
  {0,215,139,319,195,  0,-60, 94},
  {0,  0, 17,104, 73,  0,-60, 95},
  {0,  0, 78,104,134,  0,-60, 95},
  {0,  0,139,104,195,  0,-60, 95},
  {0,109, 17,213, 73,  0,-60, 95},
  {0,109, 78,213,134,  0,-60, 95},
  {0,109,139,213,195,  0,-60, 95},
  {0,  0, 17,104, 73,  0,-60, 96},
  {0,  0, 78,104,134,  0,-60, 96},
  {0,  0,139,104,195,  0,-60, 96},
  {0,109, 17,213, 73,  0,-60, 96},
  {0,109, 78,213,134,  0,-60, 96},
  {0,109,139,213,195,  0,-60, 96},
  {0,215, 17,319, 73,  0,-60, 96},
  {0,215, 78,319,134,  0,-60, 96},
  {0,215,139,319,195,  0,-60, 96},


  {0,  1, 17,103, 73, -4,-60, 531},
  {0,  1, 78,103,134, -4,-60, 531},
  {0,  1,139,103,195, -4,-60, 531},
  {0,104, 17,206, 73, -4,-60, 531},
  {0,104, 78,206,134, -4,-60, 531},
  {0,104,139,206,195, -4,-60, 531},
  {0,209, 17,311, 73, -4,-60, 531},
  {0,209, 78,311,134, -4,-60, 531},
  {0,209,139,311,195, -4,-60, 531},
  {0,  1, 17,103, 73, -4,-60, 532},
  {0,  1, 78,103,134, -4,-60, 532},
  {0,  1,139,103,195, -4,-60, 532},
  {0,104, 17,206, 73, -4,-60, 532},
  {0,104, 78,206,134, -4,-60, 532},
  {0,104,139,206,195, -4,-60, 532},
  {0,209, 17,311, 73, -4,-60, 532},
  {0,209, 78,311,134, -4,-60, 532},
  {0,209,139,311,195, -4,-60, 532},


  {0,  1, 17,103, 73, -4,-60, 533},
  {0,  1, 78,103,134, -4,-60, 533},
  {0,  1,139,103,195, -4,-60, 533},
  {0,104, 17,206, 73, -4,-60, 533},
  {0,104, 78,206,134, -4,-60, 533},
  {0,104,139,206,195, -4,-60, 533},
  {0,209, 17,311, 73, -4,-60, 533},
  {0,209, 78,311,134, -4,-60, 533},
  {0,209,139,311,195, -4,-60, 533},


  {0,  1, 17,103, 73, -4,-60, 534},
  {0,  1, 78,103,134, -4,-60, 534},
  {0,  1,139,103,195, -4,-60, 534},
  {0,104, 17,206, 73, -4,-60, 534},
  {0,104, 78,206,134, -4,-60, 534},


  {0,  6,  8, 33, 19,  0,  0, 535},
  {0,  6, 35, 33, 46,  0,  0, 535},
  {0,  6, 62, 33, 73,  0,  0, 535},
  {0,  6, 89, 33,100,  0,  0, 535},
  {0,  6,116, 33,127,  0,  0, 535},
  {0,  6,143, 33,154,  0,  0, 535},
  {0,  6,170, 33,181,  0,  0, 535},
  {0, 35,  8, 62, 19,  0,  0, 535},
  {0, 35, 35, 62, 46,  0,  0, 535},
  {0, 35, 62, 62, 73,  0,  0, 535},
  {0, 35, 89, 62,100,  0,  0, 535},
  {0, 35,116, 62,127,  0,  0, 535},
  {0, 35,143, 62,154,  0,  0, 535},
  {0, 35,170, 62,181,  0,  0, 535},
  {0, 76,  8, 88, 19,  0,  0, 535},
  {0, 76, 35, 88, 46,  0,  0, 535},
  {0, 76, 62, 88, 73,  0,  0, 535},
  {0, 76, 89, 88,100,  0,  0, 535},
  {0, 76,116, 88,127,  0,  0, 535},
  {0, 76,143, 88,154,  0,  0, 535},
  {0, 76,170, 88,181,  0,  0, 535},
  {0,102,  8,114, 19,  0,  0, 535},
  {0,102, 35,114, 46,  0,  0, 535},
  {0,102, 62,114, 73,  0,  0, 535},
  {0,102, 89,114,100,  0,  0, 535},
  {0,102,116,114,127,  0,  0, 535},
  {0,102,143,114,154,  0,  0, 535},
  {0,102,170,114,181,  0,  0, 535},
  {0,128,  8,140, 19,  0,  0, 535},
  {0,128, 35,140, 46,  0,  0, 535},
  {0,128, 62,140, 73,  0,  0, 535},
  {0,154,  8,163, 19,  0,  0, 535},
  {0,154, 35,163, 46,  0,  0, 535},
  {0,154, 62,163, 73,  0,  0, 535},
  {0,154, 89,163,100,  0,  0, 535},
  {0,154,116,163,127,  0,  0, 535},
  {0,154,143,163,154,  0,  0, 535},
  {0,154,170,163,181,  0,  0, 535},
  {0,184,  8,185, 19,  0,  0, 535},
  {0,184, 35,185, 46,  0,  0, 535},
  {0,184, 62,185, 73,  0,  0, 535},
  {0,184, 89,185,100,  0,  0, 535},
  {0,184,116,185,127,  0,  0, 535},
  {0,184,143,185,154,  0,  0, 535},
  {0,184,170,185,181,  0,  0, 535},
  {0,207,  8,223, 19,  0,  0, 535},
  {0,207, 35,223, 46,  0,  0, 535},
  {0,207, 62,223, 73,  0,  0, 535},
  {0,207, 89,223,100,  0,  0, 535},
  {0,207,116,223,127,  0,  0, 535},
  {0,207,143,223,154,  0,  0, 535},
  {0,207,170,223,181,  0,  0, 535},
  {0,235,  8,251, 19,  0,  0, 535},
  {0,267,  8,286, 19,  0,  0, 535},
  {0,267, 35,286, 46,  0,  0, 535},
  {0,267, 62,286, 73,  0,  0, 535},
  {0,267, 89,286,100,  0,  0, 535},
  {0,267,116,286,127,  0,  0, 535},


  //grabLbm(35,0,0);
  {0,  0,  0, 21, 14, 11,  7, 35},
  {0, 22,  0, 43, 14, 11,  7, 35},
  {0, 44,  0, 65, 14, 11,  7, 35},
  {0, 66,  0, 87, 14, 11,  7, 35},

  //fonts
  {0, 0,0,319,199,0,0,8},
  {0, 0,0,319,199,0,0,6},
  {0, 0,0,319,27,0,0,140},

  //grabLbm(411,0,0);
  {8, 0,0,0,0,0,0,411},

  //grabLbm(78,0,0);
  {0, 8,3,226,194,-8,-3,78},
  {0, 221,157,229,198,-221,-157,78},
  {0, 208,195,223,199,-208,-195,78},
  {0, 8,117,226,194,-8,-117,78},
  {9,0,0,0,0,0,0,549},

  //psVar12 = grabLbm(543,0,0);
  {0,8,5,16,10,0,0,543},

  //psVar12 = grabLbm(139,0,0);
  {0,16,121,57,131,0,0,139},
  {0,16,134,57,144,0,0,139},
  {0,234,121,300,131,0,0,139},
  {0,234,134,300,144,0,0,139},
  {0,153,121,230,131,0,0,139},
  {0,153,134,230,144,0,0,139},


  //psVar12 = grabLbm(179,0,0);
  {0,94,47,108,89,0,0,179},
  {0,114,47,128,89,0,0,179},
  {0,223,8,237,50,0,0,179},


  //psVar12 = grabLbm(158,0,0);
  {9,0,0,  0, 0,0,0,546},
  {0,0,0,319,80,0,0,158},

  //psVar12 = grabLbm(159,0,0);
  {0,0,0,219,143,0,0,159},

  //psVar12 = grabLbm(159,0xdc,0);
  {0,0,0,219,143,0xdc,0,159},

  //psVar12 = grabLbm(160,0,0);
  {0,0,0,279,143,0,0,160},

  //psVar12 = grabLbm(160,0x118,0);
  {0,0,0,279,143,0x118,0,160},



  //psVar12 = grabLbm(161,0,0);
  {9,0,0,0,0,0,0,547},
  {0,0,144,319,199,0,0,161},
  {0,0,0,47,10,0,0,161},

  //psVar12 = grabLbm(412,0,0);
  {9,0,0,0,0,0,0,548},
  {0,0,0,319,80,0,0,412},


  //psVar12 = grabLbm(414,0,0);
  {0,0,0,219,143,0,0,414},


  //psVar12 = grabLbm(414,0xdc,0);
  {0,0,0,219,143,0xdc,0,414},

  //psVar12 = grabLbm(413,0,0);
  {0,0,0,279,143,0,0,413},

  //psVar12 = grabLbm(413,0x118,0);
  {0,0,0,279,143,0x118,0,413},



  //psVar12 = grabLbm(422,0,0);
  {9,0,0,0,0,0,0,550},
  {0,0,0,319,113,0,0,422},

  //psVar12 = grabLbm(421,0,0);
  {0,0,0,219,143,0,0,421},

  //psVar12 = grabLbm(421,0xdc,0);
  {0,0,0,219,143,0xdc,0,421},

  //psVar12 = grabLbm(420,0,0);
  {0,0,0,279,143,0,0,420},

  //psVar12 = grabLbm(420,0x118,0);
  {0,0,0,279,143,0x118,0,420},



  //psVar12 = grabLbm(437,0,0);
  {9,0,0,0,0,0,0,551},
  {0,0,0,319,113,0,0,437},

  //psVar12 = grabLbm(438,0,0);
  {0,0,0,219,143,0,0,438},

  //psVar12 = grabLbm(438,0xdc,0);
  {0,0,0,219,143,0xdc,0,438},

  //psVar12 = grabLbm(439,0,0);
  {0,0,0,279,143,0,0,439},

  //psVar12 = grabLbm(439,0x118,0);
  {0,0,0,279,143,0x118,0,439},

  /*
  305 l1
  328 l4
  331 l7
  307 l2
  329 l5
  332 l8
  306 l3
  330 l6
  333 l9
  */
  //psVar12 = grabLbm(305,0,0);
  {6,0,0,319,59,0,0,305},
  {9,0,0,0,0,0,0,552},
  //psVar12 = grabLbm(305,320,0);
  {7,0,0,319,59,320,0,305},


  //psVar12 = grabLbm(328,0,0);
  {6,0,0,319,59,0,0,328},
  {9,0,0,0,0,0,0,553},
  //psVar12 = grabLbm(328,320,0);
  {7,0,0,319,59,320,0,328},


  //psVar12 = grabLbm(331,0,0);
  {6,0,0,319,59,0,0,331},
  {9,0,0,0,0,0,0,554},
  //psVar12 = grabLbm(331,320,0);
  {7,0,0,319,59,320,0,331},


  //psVar12 = grabLbm(307,0,0);
  {6,0,0,319,59,0,0,307},
  {9,0,0,0,0,0,0,555},
  //psVar12 = grabLbm(307,320,0);
  {7,0,0,319,59,320,0,307},


  //psVar12 = grabLbm(329,0,0);
  {6,0,0,319,59,0,0,329},
  {9,0,0,0,0,0,0,556},
  //psVar12 = grabLbm(329,320,0);
  {7,0,0,319,59,320,0,329},

  //psVar12 = grabLbm(332,0,0);
  {6,0,0,319,59,0,0,332},
  {9,0,0,0,0,0,0,557},
  //psVar12 = grabLbm(332,320,0);
  {7,0,0,319,59,320,0,332},


  //psVar12 = grabLbm(306,0,0);
  {6,0,0,319,59,0,0,306},
  {9,0,0,0,0,0,0,558},
  //psVar12 = grabLbm(306,320,0);
  {7,0,0,319,59,320,0,306},


  //psVar12 = grabLbm(330,0,0);
  {6,0,0,319,59,0,0,330},
  {9,0,0,0,0,0,0,559},
  //psVar12 = grabLbm(330,320,0);
  {7,0,0,319,59,320,0,330},


  //psVar12 = grabLbm(333,0,0);
  {6,0,0,319,59,0,0,333},
  {9,0,0,0,0,0,0,560},
  //psVar12 = grabLbm(333,320,0);
  {7,0,0,319,59,320,0,333},



};

/*

  grabBldLbm2

  //grabLbmTR(normal)
  {0,0,130,99,194,26,-1,_},
  {0,100,130,199,194,26,-1,_},
  {0,200,130,299,194,26,-1,_},
  {0,0,65,99,129,26,-1,_},
  {0,100,65,199,129,26,-1,_},
  {0,200,65,299,129,26,-1,_},
  {0,0,0,99,64,26,-1,_},
  {0,100,0,199,64,26,-1,_},
  {0,200,0,299,64,26,-1,_},

  //grabLbmTR(ruin)
  {0,0,130,99,194,26,-1,_},
  {0,100,130,199,194,26,-1,_},
  {0,200,130,299,194,26,-1,_},
  {0,0,65,99,129,26,-1,_},
  {0,100,65,199,129,26,-1,_},
  {0,200,65,299,129,26,-1,_},
  {0,0,0,99,64,26,-1,_},
  {0,100,0,199,64,26,-1,_},
  {0,200,0,299,64,26,-1,_},



  //grabBldLbm(506,507,0xd7,_},
  {0,0,130,99,194,26,-1,506},
  {0,100,130,199,194,26,-1,506},
  {0,200,130,299,194,26,-1,506},
  {0,0,65,99,129,26,-1,506},
  {0,100,65,199,129,26,-1,506},
  {0,200,65,299,129,26,-1,506},
  {0,0,0,99,64,26,-1,506},
  {0,100,0,199,64,26,-1,506},
  {0,200,0,299,64,26,-1,506},

  //grabBldLbm(506,507,0xd7,_},
  {0,0,130,99,194,26,-1,507},
  {0,100,130,199,194,26,-1,507},
  {0,200,130,299,194,26,-1,507},
  {0,0,65,99,129,26,-1,507},
  {0,100,65,199,129,26,-1,507},
  {0,200,65,299,129,26,-1,507},
  {0,0,0,99,64,26,-1,507},
  {0,100,0,199,64,26,-1,507},
  {0,200,0,299,64,26,-1,507},

*/



#define true 1

void test() {
  int ii,jj,cc,iVar7,iVar2, iVar4;

#if 0
  cc = 0;
  jj = 1;
  while( 1 ) {
    if (0x2d < jj) break;
    for (ii = 1; ii < 0x9e; ii = ii + 0x34) {
      printf("  {0,%3d,%3d,%3d,%3d,   1},\n", ii,jj,ii + 0x32,jj + 0x2a);
      cc = cc + 1;
    }
    jj = jj + 0x2c;
  }

  cc = 0;
  while( 1 ) {
    if (0xb < cc) break;
    printf("  {0,%3d,%3d,%3d,%3d, 508},\n", cc * 0x17 + 6,21,cc * 0x17 + 0x1b,62);
    cc = cc + 1;
  }

  for (cc = 0; cc < 6; cc = cc + 1) {
    printf("  {0,%3d,%3d,%3d,%3d, 508},\n",cc * 0x17 + 9,72,cc * 0x17 + 0x16,75);
  }

  cc = 0;
  while( 1 ) {
    if (2 < cc) break;
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 172},\n",cc*100+0x14, 33, cc*100+99, 116,8 , 28);

    cc = cc + 1;
  }

  cc = 0;
  while( true ) {
    if (2 < cc) break;
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 175},\n",cc * 100 + 0x14,33,cc * 100 + 99,116,8,28);
    cc = cc + 1;
  }


  iVar7 = 0;
  while( true ) {
    if (3 < iVar7) break;
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 500},\n",iVar7 * 0x30 + 3,0,iVar7 * 0x30 + 0x32,54,0,1);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 500},\n",iVar7 * 0x30 + 3,62,iVar7 * 0x30 + 0x32,116,0,1);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 500},\n",iVar7 * 0x30 + 3,62,iVar7 * 0x30 + 0x32,116,0,1);
    iVar7 = iVar7 + 1;
  }


  iVar7 = 0;
  while( true ) {
    if (3 < iVar7) break;
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 501},\n",iVar7 * 0x30 + 3,0,iVar7 * 0x30 + 0x32,54,0,1);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 501},\n",iVar7 * 0x30 + 3,62,iVar7 * 0x30 + 0x32,116,0,1);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 501},\n",iVar7 * 0x30 + 3,62,iVar7 * 0x30 + 0x32,116,0,1);
    iVar7 = iVar7 + 1;
  }


  iVar7 = 0;
  while( true ) {
    if (3 < iVar7) break;
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 502},\n",iVar7 * 0x30 + 3,0,iVar7 * 0x30 + 0x32,54,0,1);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 502},\n",iVar7 * 0x30 + 3,62,iVar7 * 0x30 + 0x32,116,0,1);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 502},\n",iVar7 * 0x30 + 3,62,iVar7 * 0x30 + 0x32,116,0,1);
    iVar7 = iVar7 + 1;
  }

  iVar7 = 0;
  while( true ) {
    if (3 < iVar7) break;
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 503},\n",iVar7 * 0x30 + 3,0,iVar7 * 0x30 + 0x32,54,0,1);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 503},\n",iVar7 * 0x30 + 3,62,iVar7 * 0x30 + 0x32,116,0,1);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 503},\n",iVar7 * 0x30 + 3,62,iVar7 * 0x30 + 0x32,116,0,1);
    iVar7 = iVar7 + 1;
  }

  iVar7 = 0;
  while( true ) {
    if (3 < iVar7) break;
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 504},\n",iVar7 * 0x30 + 3,0,iVar7 * 0x30 + 0x32,54,0,1);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 504},\n",iVar7 * 0x30 + 3,62,iVar7 * 0x30 + 0x32,116,0,1);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 504},\n",iVar7 * 0x30 + 3,62,iVar7 * 0x30 + 0x32,116,0,1);
    iVar7 = iVar7 + 1;
  }

  iVar7 = 0;
  while( true ) {
    if (3 < iVar7) break;
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 505},\n",iVar7 * 0x30 + 3,0,iVar7 * 0x30 + 0x32,54,0,1);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 505},\n",iVar7 * 0x30 + 3,62,iVar7 * 0x30 + 0x32,116,0,1);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 505},\n",iVar7 * 0x30 + 3,62,iVar7 * 0x30 + 0x32,116,0,1);
    iVar7 = iVar7 + 1;
  }

  iVar7 = 0;
  while( true ) {
    if (2 < iVar7) break;
    for (cc = 0; cc < 3; cc = cc + 1) {
      printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 11},\n",cc * 100,iVar7 * 0x41,cc * 100 + 99,iVar7 * 0x41 + 0x40,30,-4);
    }
    iVar7 = iVar7 + 1;
  }


  for (cc = 0; cc < 6; cc = cc + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 52},\n",13,cc * 0x21 + 0x14,16,cc * 0x21 + 0x20,-22,-44);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 52},\n",95,cc * 0x21 + 0x14,98,cc * 0x21 + 0x20,-22,-44);
  }



  for (cc = 0; cc < 5; cc = cc + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 523},\n",cc * 0x22 + 0x50,39,cc * 0x22 + 0x68,58,-68,22);
  }

  printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 523},\n",82,87,222,181,22,32);
  printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 523},\n",82,87,222,181,22,32);


  printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 156},\n",0,101,319,199,60,26);
  printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 156},\n",0,0,319,100,60,28);
  printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 156},\n",0,101,319,199,60,26);
  printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 156},\n",0,0,319,100,60,28);
  printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 156},\n",0,70,319,193,60,51);
  printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 156},\n",0,70,319,193,60,51);


  iVar2 = 0;
  while( true ) {
    if (2 < iVar2) break;
    for (cc = 0; cc < 2; cc = cc + 1) {
      if ((cc != 0) || (iVar2 != 0)) {
        printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 17},\n",cc * 0x87,iVar2 * 0x41,cc * 0x87 + 0x86,
                                 iVar2 * 0x41 + 0x40,30,-10);
      }
    }
    iVar2 = iVar2 + 1;
  }

  //grabLbmTR(527);
  iVar4 = 0;
  while( true ) {
    if (2 < iVar4) break;
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 527},\n",iVar4 * 100 + 0x14,33,iVar4 * 100 + 99,116,10,28);
    iVar4 = iVar4 + 1;
  }

  //grabLbmTR(528);
  iVar4 = 0;
  while( true ) {
    if (2 < iVar4) break;
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 528},\n",iVar4 * 100 + 0x14,33,iVar4 * 100 + 99,116,10,28);
    iVar4 = iVar4 + 1;
  }




  //uStack_a = grabLbm(12,0,0);
  for (iVar4 = 0; iVar4 < 4; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,  0,  0, 12},\n",iVar4 * 0xe,46,iVar4 * 0xe + 0xd,55);
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 12},\n",iVar4 * 0xe,16,iVar4 * 0xe + 0xd,24,6,4);
  }


  //psVar12 = grabLbm(93,0,0);
  for (iVar4 = 0; iVar4 < 6; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 93},\n",8,iVar4 * 0x20 + 10,63,iVar4 * 0x20 + 0x24,0,0);
  }
  for (iVar4 = 0; iVar4 < 6; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 93},\n",85,iVar4 * 0x20 + 10,140,iVar4 * 0x20 + 0x24,0,0);
  }
  for (iVar4 = 0; iVar4 < 6; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 93},\n",159,iVar4 * 0x20 + 10,214,iVar4 * 0x20 + 0x24,0,0);
  }
  for (iVar4 = 0; iVar4 < 5; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 93},\n",229,iVar4 * 0x20 + 10,284,iVar4 * 0x20 + 0x24,0,0);
  }

  //psVar12 = grabLbm(94,0,0);
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 94},\n",0,iVar4 * 0x3d + 0x11,104,iVar4 * 0x3d + 0x49,0,-60);
  }
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 94},\n",109,iVar4 * 0x3d + 0x11,213,iVar4 * 0x3d + 0x49,0,-60);
  }
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 94},\n",215,iVar4 * 0x3d + 0x11,319,iVar4 * 0x3d + 0x49,0,-60);
  }

  //psVar12 = grabLbm(95,0,0);
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 95},\n",0,iVar4 * 0x3d + 0x11,104,iVar4 * 0x3d + 0x49,0,-60);
  }
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 95},\n",109,iVar4 * 0x3d + 0x11,213,iVar4 * 0x3d + 0x49,0,-60);
  }

  //psVar12 = grabLbm(96,0,0);
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 96},\n",0,iVar4 * 0x3d + 0x11,104,iVar4 * 0x3d + 0x49,0,-60);
  }
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 96},\n",109,iVar4 * 0x3d + 0x11,213,iVar4 * 0x3d + 0x49,0,-60);
  }
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 96},\n",215,iVar4 * 0x3d + 0x11,319,iVar4 * 0x3d + 0x49,0,-60);
  }

  //psVar12 = grabLbm(531,0,0);
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 531},\n",1,iVar4 * 0x3d + 0x11,103,iVar4 * 0x3d + 0x49,-4,-60);
  }
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 531},\n",104,iVar4 * 0x3d + 0x11,206,iVar4 * 0x3d + 0x49,-4,-60);
  }
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 531},\n",209,iVar4 * 0x3d + 0x11,311,iVar4 * 0x3d + 0x49,-4,-60);
  }

  //psVar12 = grabLbm(532,0,0);
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 532},\n",1,iVar4 * 0x3d + 0x11,103,iVar4 * 0x3d + 0x49,-4,-60);
  }
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 532},\n",104,iVar4 * 0x3d + 0x11,206,iVar4 * 0x3d + 0x49,-4,-60);
  }
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 532},\n",209,iVar4 * 0x3d + 0x11,311,iVar4 * 0x3d + 0x49,-4,-60);
  }

  //psVar12 = grabLbm(533,0,0);
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 533},\n",1,iVar4 * 0x3d + 0x11,103,iVar4 * 0x3d + 0x49,-4,-60);
  }
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 533},\n",104,iVar4 * 0x3d + 0x11,206,iVar4 * 0x3d + 0x49,-4,-60);
  }
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 533},\n",209,iVar4 * 0x3d + 0x11,311,iVar4 * 0x3d + 0x49,-4,-60);
  }

  //psVar12 = grabLbm(534,0,0);
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 534},\n",1,iVar4 * 0x3d + 0x11,103,iVar4 * 0x3d + 0x49,-4,-60);
  }
  for (iVar4 = 0; iVar4 < 2; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 534},\n",104,iVar4 * 0x3d + 0x11,206,iVar4 * 0x3d + 0x49,-4,-60);
  }

  //uStack_a = grabLbm(535,0,0);
  for (iVar4 = 0; iVar4 < 7; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 535},\n",6,iVar4 * 0x1b + 8,33,iVar4 * 0x1b + 0x13,0,0);
  }
  for (iVar4 = 0; iVar4 < 7; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 535},\n",35,iVar4 * 0x1b + 8,62,iVar4 * 0x1b + 0x13,0,0);
  }
  for (iVar4 = 0; iVar4 < 7; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 535},\n",76,iVar4 * 0x1b + 8,88,iVar4 * 0x1b + 0x13,0,0);
  }
  for (iVar4 = 0; iVar4 < 7; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 535},\n",102,iVar4 * 0x1b + 8,114,iVar4 * 0x1b + 0x13,0,0);
  }
  for (iVar4 = 0; iVar4 < 3; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 535},\n",128,iVar4 * 0x1b + 8,140,iVar4 * 0x1b + 0x13,0,0);
  }
  for (iVar4 = 0; iVar4 < 7; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 535},\n",154,iVar4 * 0x1b + 8,163,iVar4 * 0x1b + 0x13,0,0);
  }
  for (iVar4 = 0; iVar4 < 7; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 535},\n",184,iVar4 * 0x1b + 8,185,iVar4 * 0x1b + 0x13,0,0);
  }
  for (iVar4 = 0; iVar4 < 7; iVar4 = iVar4 + 1) {
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 535},\n",207,iVar4 * 0x1b + 8,223,iVar4 * 0x1b + 0x13,0,0);
  }
  printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 535},\n",235,8,251,19,0,0);

  iVar4 = 0;
  while( true ) {
    if (4 < iVar4) break;
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 535},\n",267,iVar4 * 0x1b + 8,286,iVar4 * 0x1b + 0x13,0,0);
    iVar4 = iVar4 + 1;
  }

#endif

  //uStack_a = grabLbm(35,0,0);
  iVar4 = 0;
  while( true ) {
    if (3 < iVar4) break;
    printf("  {0,%3d,%3d,%3d,%3d,%3d,%3d, 35},\n",iVar4 * 0x16,0,iVar4 * 0x16 + 0x15,14,11,7);
    iVar4 = iVar4 + 1;
  }

  exit(0);
}




int unrle(uint8_t *src, uint8_t *dst, int sz) {
  uint8_t *q;
  uint8_t b;
  int i;
  uint8_t *end = dst + sz;
  uint8_t *ps;
  uint8_t *s = src;

  do {
    do {
      ps = s;
      s = ps + 1;
      b = *ps;
    } while (b == 0x80);
    if (b < 0x80) {
      i = (uint8_t)(b + 1);
      do {
        q = s;
        s = s + 1;
        if (*q != 0) {
          *dst = *q;
        }
        dst = dst + 1;
        i = i - 1;
      } while (i != 0);
    }
    else {
      i = (uint8_t)((b ^ 0xff) + 2);
      q = s;
      s = ps + 2;
      b = *q;
      if (b == 0) {
        dst = dst + i;
      }
      else {
        for (; i != 0; i = i - 1) {
          q = dst;
          dst = dst + 1;
          *q = b;
        }
      }
    }
  } while (dst < end);
  return s - src;
}


int is_txt(uint8_t *p, uint32_t size) {
  uint32_t i;
  if (!size) return 0;
  //if (p[size-1] != 0x1A) return 0;
  for (i = 0; i < size; i++) {
    if (p[i] >= 0x80) return 0;
    if (p[i] == 0x1A && i==size-1) continue;
    if (p[i] < 0x20 && p[i]!=0xd && p[i]!=0xa) return 0;
  }
  return 1;
}


int names_count;
char *names[5000];


void load_names() {
  if (!file_exists("./names.txt")) fail("File doesn't exist: names.txt");

  int64_t names_size;
  char *p = read_whole_file("./names.txt", &names_size);
  p[names_size] = 0;
  while(*p) {
    names[names_count++] = p;
    while(*p && *p != '\n') {
      if (*p == '/') *p = '_';
      ++p;
    }
    if (*p == '\n') *p++ = 0;
  }
}


uint8_t *normalizeSkylinePal(uint8_t *base, uint8_t *q) {
  int j;
  uint8_t *pal = new(uint8_t,256*3);
  memcpy(pal, base, 256*3);
  for (j = 0; j < 48; j++) { //160*3
    pal[(j+160)*3+0] = q[j*3 + 0];
    pal[(j+160)*3+1] = q[j*3 + 1];
    pal[(j+160)*3+2] = q[j*3 + 2];
  }
  return pal;
}

int main(int argc, char **argv) {
  int i, j, k;
  int nexts = sizeof(einfo)/sizeof(einfo[0]);


  NAP_INTRO
  NAP_IF("h") usage(); NAP_FI
  NAP_OUTRO(2,2)



  char *outpath = fargv[1];
  if (outpath[strlen(outpath)-1] != '/') outpath = cat(outpath,"/");

  if (!file_exists(fargv[0])) fail("File doesn't exist: %s", fargv[0]);


  load_names();
  
  //test();

  
  int64_t file_size;
  uint8_t *file = read_whole_file(fargv[0], &file_size);
  uint32_t ctofs = *(uint32_t*)file; //files table offset
  uint32_t ctsz = file_size - ctofs;
  int nitems = ctsz/sizeof(cte_t);

  printf("Content Table Offset: %x\n", ctofs);
  printf("Content Table Size: %x\n", ctsz);
  printf("Number of entries: %d\n", nitems);

  //do sanity check
  if (ctofs+sizeof(cte_t)*100 > file_size
      || nitems < 100 || nitems > 0x8000
      || file_size < ctsz*10
      || ctsz%sizeof(cte_t)
      ) {
    fail("Invalid STRONG.DAT");
  }

  cte_t *ct = (cte_t*)(file+ctofs);

#if 0
  for (i = 0; i < nitems; i++) {
    printf("%04d: Ofs=%x Sz=%x\n", i, ct[i].ofs, ct[i].sz);
    if (ct[i].state) fail("entry %d has non-null state", i);
    for (j = 0; j < 12; j++)
      if (ct[i].info[j]) fail("entry %d has non-null info", i);
  }
#endif



#if 0
  for (i = 0; i < nitems; i++) {
    printf("Dumping entry %d...\n", i);
    write_whole_file_path(fmt("%s%04d",outpath, i), file+ct[i].ofs, ct[i].sz);
  }
  printf("Done!\n");
#endif


#if 1
  uint8_t *bpal = file+ct[741].ofs; //base palette
  uint8_t *pal = file+ct[741].ofs; //nwpanel1.lbm's palette
  for (i = 0; i < nitems; i++) {
    einfo_t *ei = (i < nexts) ? &einfo[i] : 0;
    char *name = ei ? names[ei->nid] : "";
    //if (!ei || ei->type != 8) continue;
    stg_t *stg = (stg_t*)(file+ct[i].ofs);
    stg2_t *stg2 = (stg2_t*)(file+ct[i].ofs);
    stg3_t *stg3 = (stg3_t*)(file+ct[i].ofs);
    stg4_t *stg4 = (stg4_t*)(file+ct[i].ofs);
    if (stg->type==1 && stg->w && stg->h && stg->sz && stg->w <= 320 && stg->h <= 200 && stg->sz <= 320*200+9) {
      //continue;
      printf("%d: type1 %dx%d %d bytes %s\n", i, stg->w, stg->h, stg->sz, name);
      pic_t *pic = picNew(stg->w, stg->h, 8);
      unrle((uint8_t*)(stg+1), pic->D, stg->w*stg->h);
      pic->P = new(uint8_t,4*256);
      pic->K = 0;
      uint8_t *q = pal;
      if (ei && ei->type == 6) q = normalizeSkylinePal(bpal,file+ct[i+1].ofs);
      if (ei && ei->type == 7) q = normalizeSkylinePal(bpal,file+ct[i-1].ofs);
      for (j = 0; j < 256; j++) {
        pic->P[j*4+0] = q[j*3 + 0]<<2;
        pic->P[j*4+1] = q[j*3 + 1]<<2;
        pic->P[j*4+2] = q[j*3 + 2]<<2;
        pic->P[j*4+3] = 0;
      }
      //picClear(pic, 0xFF00FF);
      pngSave(fmt("%s%04dt1%s.png",outpath, i, name), pic);
    } else if (stg2->type==2 && stg2->w && stg2->h && stg2->sz && stg2->w <= 320 && stg2->h <= 200 && stg2->sz <= 320*200+0xE) {
      //continue;
      printf("%d: type2 %dx%d (%d,%d) %d bytes %s\n", i, stg2->w, stg2->h, stg2->x, stg2->y, stg2->sz, name);
      pic_t *pic = picNew(stg2->w, stg2->h, 8);
      unrle((uint8_t*)(stg2+1), pic->D, stg2->w*stg2->h);
      pic->P = new(uint8_t,4*256);
      pic->K = 0;
      uint8_t *q = pal;
      if (ei && ei->nid == 78) q = file+ct[906].ofs;
      for (j = 0; j < 256; j++) {
        pic->P[j*4+0] = q[j*3 + 0]<<2;
        pic->P[j*4+1] = q[j*3 + 1]<<2;
        pic->P[j*4+2] = q[j*3 + 2]<<2;
        pic->P[j*4+3] = 0;
      }
      pngSave(fmt("%s%04dt2%s.png",outpath, i,name), pic);
    } else if (stg3->type==3 && stg3->sz && stg3->sz <= ct[i].sz && !stg3->w && !stg3->h) {
      //continue;
      printf("%d: type3 %dx%d %s\n", i, stg3->w, stg3->h, name);
      write_whole_file_path(fmt("%s%04dt3%s.b",outpath, i,name),
         file+ct[i].ofs, ct[i].sz);
    } else if (stg4->type==4 && stg4->w && stg4->h && stg4->sz && stg4->w <= 320 && stg4->h <= 200 && stg4->sz <= 320*200+sizeof(stg4_t)) {
      //continue;
      printf("%d: type4 %dx%d (%d,%d) %d bytes %s\n", i, stg4->w, stg4->h, stg4->x, stg4->y, stg4->sz, name);
      pic_t *pic = picNew(stg4->w, stg4->h, 8);
      unrle((uint8_t*)(stg4+1), pic->D, stg4->w*stg4->h);
      pic->P = new(uint8_t,4*256);
      uint8_t *upal = file+ct[741].ofs;
      pic->K = 0;
      for (j = 0; j < 256; j++) {
        pic->P[j*4+0] = upal[j*3 + 0]<<2;
        pic->P[j*4+1] = upal[j*3 + 1]<<2;
        pic->P[j*4+2] = upal[j*3 + 2]<<2;
        pic->P[j*4+3] = 0;
      }
      pngSave(fmt("%s%04dt4%s.png",outpath, i,name), pic);
    } else if (ct[i].sz==768) {
      pal = file+ct[i].ofs;
      //continue;
      printf("%d: palette\n", i);
      pic_t *pic = picNew(16, 16, 8);
      pic->P = new(uint8_t,4*256);
      uint8_t *q = file+ct[i].ofs;
      for (j = 0; j < 256; j++) {
        pic->P[j*4+0] = q[j*3 + 0]<<2;
        pic->P[j*4+1] = q[j*3 + 1]<<2;
        pic->P[j*4+2] = q[j*3 + 2]<<2;
        pic->P[j*4+3] = 0;
        picPut(pic, j%16, j/16, j);
      }
      //picClear(pic, 0xFF00FF);
      pngSave(fmt("%s%04d%s.png",outpath, i, name), pic);
    } else if (is_txt(file+ct[i].ofs, ct[i].sz)) {
      //continue;
      printf("%d: %s dumping txt...\n", i, name);
      write_whole_file_path(fmt("%s%04d%s.txt",outpath, i,name), file+ct[i].ofs, ct[i].sz);
    } else if (ei && ei->type == 8) {
      uint8_t *q = file+ct[i].ofs;
      int nchars = 96;
      int h = *q;
      int w = nchars * *q;
      printf("%d: font %dx%d %d bytes %s\n", i, h, h, ct[i].sz, name);

      pic_t *pic = picNew(w, h, 8);

      //printf("%x\n", h);
      for (j = 0; j < nchars; j++) {
        //printf("  %2d: ofs=%x w=%d\n", j, *(uint16_t*)(q + 1 + j*2), *(q+0xC1+j));
        int cw = *(q+0xC1+j);
        int x, y;
        uint8_t *p = q + 0x121 + *(uint16_t*)(q + 1 + j*2);
        for (y = 0; y < h; y++) {
          for (x = 0; x < cw; x++) {
            picPut(pic, pic->H*j+x, y, p[y*cw+x]);
          }
        }
      }
      pic->P = new(uint8_t,4*256);
      pic->K = 0;
      q = pal;
      for (j = 0; j < 256; j++) {
        pic->P[j*4+0] = q[j*3 + 0]<<2;
        pic->P[j*4+1] = q[j*3 + 1]<<2;
        pic->P[j*4+2] = q[j*3 + 2]<<2;
        pic->P[j*4+3] = 0;
      }
      pngSave(fmt("%s%04d%s.png",outpath, i, name), pic);
    } else if (ct[i].sz=144) {
      printf("%d: skyline palette\n", i);
      pal = normalizeSkylinePal(bpal,file+ct[i].ofs);
      pic_t *pic = picNew(16, 16, 8);
      uint8_t *q = pal;
      for (j = 0; j < 256; j++) {
        pic->P[j*4+0] = q[j*3 + 0]<<2;
        pic->P[j*4+1] = q[j*3 + 1]<<2;
        pic->P[j*4+2] = q[j*3 + 2]<<2;
        pic->P[j*4+3] = 0;
        picPut(pic, j%16, j/16, j);
      }
      pngSave(fmt("%s%04d%s.png",outpath, i, name), pic);
    } else {
      //continue;
      printf("%d: %s dumping raw...\n", i, name);
      write_whole_file_path(fmt("%s%04d%s.b",outpath, i,name), file+ct[i].ofs, ct[i].sz);
    }
  }
  printf("Done!\n");
#endif

  return 0;
}

